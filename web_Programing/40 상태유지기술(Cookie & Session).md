# 상태유지기술(Cookie & Session)



## 상태정보란?



### 웹에서의 상태 유지 기술

+ HTTP프로토콜은 상태 유지가 되지 않는 프로토콜이다.
  + 이전에 무엇을 했고, 지금 무엇을 했는지에 대한 정보를 갖고 있지 않음
  + 웹 브라우저(클라이언트)의 요청에 대한 응답을 하고 나면 해당 클라이언트와의 연결을 지속하지 않음.
+ 상태 유지를 위해 Cookie와 Session기술이 등장함.



### 쿠키(Cooke)와 세션(Session)

+ 쿠키

  + 유지해야 할 정보를 사용자 컴퓨터에 저장
  + 저장된 정보를 다른 사람 또는 시스템이 볼 수 있는 단점
  + 유효기간이 지나면 사라짐

+ 세션

  + 서버에 저장
  + 서버가 종료되거나 유효시간이 지나면 사라짐

  

### 쿠키(Cookie) 동작 이해

![1](https://user-images.githubusercontent.com/88477839/163569857-dd3e98f9-468c-4535-9446-59f500f7592f.png)

+ 클라이언트가 서버 쪽에 요청을 보냄
+ 이때 유지해야 할 정보가 있다면 서버는 유지할 정보를 가지고 쿠키를 생성함
  + 이때 쿠키는 이름과 값으로 구성이 되어 있고 유지 시간 등의 정보를 가지게 된다.
+ 이렇게 만들어진 쿠키는 반드시 응답 결과에 포함되어서 클라이언트한테 보내져야 한다.



![2 (1)](https://user-images.githubusercontent.com/88477839/163570106-4613bb1b-0d77-4d39-850d-d0e925914fad.png)

+ 만들어진 쿠키는 클라이언트가 갖고 있게 되고, 요청을 보낼때 항상 쿠키를 같이 포함 시켜서 서버에게 보낸다.
+  서버는 지난번에 만들어준 쿠키가 있는지 검사를 한다.
  + 지난번에 만든 쿠키가 있다고 한다면 이 사용자가 전에 접속했던 사용자인지 또는 사용자가 유지해야 되는 정보가 이것인지 인식하게 된다.



### 세션 동작 이해

![3 (1)](https://user-images.githubusercontent.com/88477839/163570420-c00c0342-ff9b-4b88-8301-df567f5fca68.png)

+ 클라이언트가 요청을 했을 때 유지해야 되는 정보가 있다면 서버는 세션키를 만들어낸다.
+ 그리고 세션키를 이용한 저장소를 하나 생성한다. 
  + 이 저장소에다가 유지해야 되는 정보들을 저장하게 된다.
  + 그런데 저장소만 만들어놓고 그냥 끝나버리면, 추후에 클라이언트가 요청을 했을때 이 클라이언트의 저장소가 어떤 곳인지 서버는 알아낼 길이 없다.
+ 그래서 서버는 세션키를 담은 쿠키를 생성해서 클라이언트한테 보낸다.

![4 (1)](https://user-images.githubusercontent.com/88477839/163570759-ff11e124-ba13-45f5-9fea-912585a77b6e.png)

+ 클라이언트는 다시 요청할때마다 서버가 만들어서 보낸 쿠키를 가지고 매번 들어온다.
+ 서버는 쿠키로부터 세션키를 얻고, 이 세션키에 해당하는 저장소를 찾아서 저장소 안에 있는 정보를 활용하거나 저장소에다가 원하는 정보를 저장하는 일을 수행하게 된다.
+ 이때 세션의 정보를 담기 위해 생성되는 객체가  HttpSession이라는 객체를 이용하게 된다.

